{% extends "base_template.html" %}

{% block title %}Datasets API{% endblock %}

{% block content %}

<div class="container-fluid p-0">

    <h1 class="h3 mb-3"><b>Datasets</b> API</h1>

    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">All Datasets</h5>
                </div>
                <div class="card-body">
                    
                    {% if datasets %}
                    
                    <div class="table-responsive">
                        <table class="table table-striped table-hover">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Name</th>
                                    <th>DOI</th>
                                    <th>Created</th>
                                    <th>Files</th>
                                    <th>Total Size</th>
                                    <th>Downloads</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for dataset in datasets %}
                                <tr>
                                    <td><strong>{{ dataset.id }}</strong></td>
                                    <td>{{ dataset.ds_meta_data.title }}</td>
                                    <td>
                                        <a href="{{ dataset.get_uvlhub_doi() }}" target="_blank">
                                            {{ dataset.ds_meta_data.dataset_doi }}
                                        </a>
                                    </td>
                                    <td>{{ dataset.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
                                    <td>
                                        <span class="badge bg-info">
                                            {{ dataset.get_files_count() }} files
                                        </span>
                                    </td>
                                    <td>{{ dataset.get_file_total_size_for_human() }}</td>
                                    <td>
                                        <span class="badge bg-success">
                                            <i data-feather="download" style="width: 14px; height: 14px;"></i>
                                            <strong data-download-counter="{{ dataset.id }}">{{ dataset.download_count }}</strong>
                                        </span>
                                    </td>
                                    <td>
                                        <a href="{{ dataset.get_uvlhub_doi() }}" class="btn btn-sm btn-outline-primary" title="View dataset">
                                            <i data-feather="eye"></i>
                                        </a>
                                        <a href="/dataset/download/{{ dataset.id }}" 
                                           class="btn btn-sm btn-outline-success" 
                                           title="Download"
                                           data-download-btn
                                           data-dataset-id="{{ dataset.id }}">
                                            <i data-feather="download"></i>
                                        </a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>

                    <div class="mt-3">
                        <p class="text-muted">
                            <i data-feather="info" style="width: 16px; height: 16px;"></i>
                            Total datasets: <strong>{{ datasets|length }}</strong>
                        </p>
                    </div>

                    {% else %}
                    
                    <div class="alert alert-info" role="alert">
                        <div class="alert-message">
                            <h4 class="alert-heading">
                                <i data-feather="info"></i> No datasets found
                            </h4>
                            <p>There are no datasets available at the moment.</p>
                        </div>
                    </div>
                    
                    {% endif %}

                </div>
            </div>

            <!-- JSON API Information Card -->
            <div class="card mt-3">
                <div class="card-header">
                    <h5 class="card-title mb-0">JSON API Endpoints</h5>
                </div>
                <div class="card-body">
                    <p>You can also access the data in JSON format:</p>
                    
                    <div class="mb-3">
                        <strong>Get all datasets:</strong>
                        <code class="ms-2">GET /api/v1/datasets/</code>
                        <a href="/api/v1/datasets/" class="btn btn-sm btn-outline-secondary ms-2" target="_blank">
                            <i data-feather="external-link"></i> Try it
                        </a>
                    </div>
                    
                    <div class="mb-3">
                        <strong>Get specific dataset:</strong>
                        <code class="ms-2">GET /api/v1/datasets/&lt;id&gt;</code>
                        {% if datasets %}
                        <a href="/api/v1/datasets/{{ datasets[0].id }}" class="btn btn-sm btn-outline-secondary ms-2" target="_blank">
                            <i data-feather="external-link"></i> Example
                        </a>
                        {% endif %}
                    </div>

                    <div class="mb-3">
                        <strong>Get dataset stats:</strong>
                        <code class="ms-2">GET /dataset/&lt;id&gt;/stats</code>
                        {% if datasets %}
                        <a href="/dataset/{{ datasets[0].id }}/stats" class="btn btn-sm btn-outline-secondary ms-2" target="_blank">
                            <i data-feather="external-link"></i> Example
                        </a>
                        {% endif %}
                    </div>
                </div>
            </div>

        </div>
    </div>

</div>

{% endblock %}
